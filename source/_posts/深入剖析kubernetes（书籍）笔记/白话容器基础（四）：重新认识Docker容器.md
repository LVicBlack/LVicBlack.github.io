---
title: 白话容器基础（四）：重新认识Docker容器
date: 2021-10-11 10:06:00
categories: 
- 深入剖析kubernetes（书籍）笔记
- 容器技术概念入门
tags:
- kubernetes
---

## 重新认识Docker容器

### Docker总结

#### 容器与虚拟机对比
**容器的本质是一个进程，只不过这个进程加上了视图上的隔离和资源上的限制。 **
就容器本质而言，它并没有在宿主机上启动一个“容器进程”，它启动的还是用户原来要启动的应用程序，只不过这个应用程序上加了视图隔离和资源限制。
虚拟机也能实现视图隔离和资源限制，但它底层的技术实现与容器不同，在宿主机上你能看到这样一个“虚拟机进程”。
因此，与容器相比，虚拟机会带来更多的性能损耗，主要在：
1. 虚拟机本身的进程需要占用一部分资源 
2. 与底层硬件交互的时候（网络、磁盘I/O）都需要经过虚拟化软件拦截，会有损耗。但是**它比容器有更好的隔离性和安全性。**

#### 容器使用的底层技术
1. 视图隔离：Namespace 
2. 资源限制：cgropus

#### Docker核心原理
>为待创建的用户进程：
>1. 启用 Linux Namespace 配置；**视图隔离**
>2. 设置指定的 Cgroups 参数；**资源限制**
>3. 切换进程的根目录（Change Root）。**挂载。容器镜像生效，以实现环境一致性。所谓容器镜像，本质就是容器的根文件系统(rootfs)。**

Docker 项目在最后一步的切换上会优先使用 pivot_root 系统调用，如果系统不支持，才会使用 chroot。

>pivot_root与chroot的区别：
>- chroot是只改变即将运行的 某进程的根目录。
>- pviot_root主要是把整个系统切换到一个新的root目录，然后去掉对之前rootfs的依赖，以便于可以umount 之前的文件系统（pivot_root需要root权限）

Docker容器的增量rootfs：即下层已经生成的永远不会改变，所有的修改都通过在上层叠加。比如，删除A文件，就是在上层添加一个“白障”，让系统无法读取到下层A文件。修改则是先copy一个备份到新的层（新老的文件可能都在可读写层），然后读取的时候直接读取新的层。

Docker通过Volume来实现将宿主机的文件挂载到容器中

### 实际案例

本文会通过一个实际案例，对“白话容器基础”系列的所有内容做一次深入的总结和扩展。








































